; This stunnel config is managed by Puppet.
<% if protocol %>protocol = <%= protocol %><% end -%>
sslVersion = <%= ssl_version %>
<% if client %>client = yes<% end -%>

setuid = <%= user %>
setgid = <%= group %>
pid = <%= pid %>
<% if chroot %>chroot = <%= chroot %><% end -%>

socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
TIMEOUTclose = 0

debug = <%= debug_level %>
output = <%= output %>

<% if verify %>verify = <%= verify %><% end -%>
<% if cert %>cert = <%= cert %><% end -%>
<% if key %>key = <%= CAfile %><% end -%>
<% if CAfile %>CAfile = <%= CAfile %><% end -%>
<% if CRLfile %>CRLfile = <%= CRLfile %><% end -%>

<% services.each_pair do |service, param| %>
[<%= service %>]
accept = <% if param['accept'] %><%= param['accept'] %><% else %><%= accept %><% end -%>
connect = <% if param['connect'] %><%= param['connect'] %><% else %><%= connect %><% end -%>
<% if param['cert'] %>cert = <%= param['cert'] %><% elseif cert %>cert = <%= cert %><% end -%>
<% if param['key'] %>key = <%= param['key'] %><% elseif %>key = <%= key %><% end -%>
<% if param['CAfile'] %>CAfile = <%= param['CAfile'] %><% elseif cert %>CAfile = <%= CAfile %><% end -%>
<% if param['CRLfile'] %>CRLfile = <%= param['CRLfile'] %><% elseif %>CRLfile = <%= CRLfile %><% end -%>

<% end -%>